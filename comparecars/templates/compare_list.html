{% extends 'base.html' %}
{% load static %}
{% block content %}
<section class="bg-gradient-to-b from-black via-indigo-900 to-indigo-700 text-white min-h-screen py-12">
    <h1 class="container mx-auto p-6 text-3xl font-bold text-center">Comparison List</h1>

    <!-- Button to Add a New Comparison -->
    <div class="text-center mb-8">
        <button class="add-comparison-button bg-blue-600 hover:bg-green-600 text-white py-3 px-6 rounded-full font-semibold text-lg transition" 
                onclick="window.location.href='{% url 'compare_cars' %}'">
            Add New Comparison
        </button>
    </div>

    <!-- Comparison List -->
    <div class="comparison-list grid gap-8 max-w-6xl mx-auto grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4">
        {% if comparisons %}
            {% for comparison in comparisons %}
            <!-- Comparison Card -->
            <div id="comparison-{{ comparison.id }}" class="comparison-card bg-white text-black rounded-xl p-4 shadow-lg hover:shadow-2xl transform transition hover:-translate-y-2 relative">

                <!-- Delete Button -->
                <button class="absolute top-2 right-2 text-red-600 hover:text-red-800 text-lg" onclick="event.preventDefault(); event.stopPropagation(); deleteComparison({{ comparison.id }})">
                    X
                </button>

                <!-- Wrap the card content in an <a> tag -->
                <a href="{% url 'compare_cars_with_id' comparison.id %}" class="block w-full h-full">
                    <!-- Car Images -->
                    <div class="flex gap-2 mb-4">
                        <img class="w-1/2 rounded-md" src="{% static 'images/' %}{{ comparison.comparecar.car1.brand }}.png" alt="{{ comparison.comparecar.car1.brand }}">
                        <img class="w-1/2 rounded-md" src="{% static 'images/' %}{{ comparison.comparecar.car2.brand }}.png" alt="{{ comparison.comparecar.car2.brand }}">
                    </div>

                    <!-- Comparison Details -->
                    <h3 class="text-lg font-semibold mb-2">Comparison {{ forloop.counter }}</h3>
                    <p class="text-sm text-gray-700">{{ comparison.comparecar.car1.brand }} vs {{ comparison.comparecar.car2.brand }}</p>
                </a>
            </div>
            {% endfor %}
        {% else %}
            <p class="text-center text-lg">No saved comparisons yet.</p>
        {% endif %}
    </div>
</section>

<script>
    function deleteComparison(id) {
        // Make a DELETE request using AJAX
        fetch(`/comparecars/compare/${id}/`, {
            method: 'DELETE',
            headers: {
                'X-CSRFToken': getCookie('csrftoken')  // CSRF token for security
            }
        })
        .then(response => {
            if (response.ok) {
                // Remove the deleted comparison card from the DOM
                const comparisonCard = document.getElementById(`comparison-${id}`);
                if (comparisonCard) {
                    comparisonCard.remove();
                }
            } else {
                alert('Failed to delete comparison');
            }
        })
        .catch(error => {
            console.error('Error during deletion:', error);
            alert('An error occurred while deleting the comparison.');
        });
    }

    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
</script>
{% endblock content %}
